export default "import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  // FIXED: Point to client/dist where the React app actually builds to\n  const distPath = path.resolve(import.meta.dirname, \"..\", \"client\", \"dist\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist (SPA fallback)\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n";

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpdGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgXCJpbXBvcnQgZXhwcmVzcywgeyB0eXBlIEV4cHJlc3MgfSBmcm9tIFxcXCJleHByZXNzXFxcIjtcXG5pbXBvcnQgZnMgZnJvbSBcXFwiZnNcXFwiO1xcbmltcG9ydCBwYXRoIGZyb20gXFxcInBhdGhcXFwiO1xcbmltcG9ydCB7IGNyZWF0ZVNlcnZlciBhcyBjcmVhdGVWaXRlU2VydmVyLCBjcmVhdGVMb2dnZXIgfSBmcm9tIFxcXCJ2aXRlXFxcIjtcXG5pbXBvcnQgeyB0eXBlIFNlcnZlciB9IGZyb20gXFxcImh0dHBcXFwiO1xcbmltcG9ydCB2aXRlQ29uZmlnIGZyb20gXFxcIi4uL3ZpdGUuY29uZmlnXFxcIjtcXG5pbXBvcnQgeyBuYW5vaWQgfSBmcm9tIFxcXCJuYW5vaWRcXFwiO1xcblxcbmNvbnN0IHZpdGVMb2dnZXIgPSBjcmVhdGVMb2dnZXIoKTtcXG5cXG5leHBvcnQgZnVuY3Rpb24gbG9nKG1lc3NhZ2U6IHN0cmluZywgc291cmNlID0gXFxcImV4cHJlc3NcXFwiKSB7XFxuICBjb25zdCBmb3JtYXR0ZWRUaW1lID0gbmV3IERhdGUoKS50b0xvY2FsZVRpbWVTdHJpbmcoXFxcImVuLVVTXFxcIiwge1xcbiAgICBob3VyOiBcXFwibnVtZXJpY1xcXCIsXFxuICAgIG1pbnV0ZTogXFxcIjItZGlnaXRcXFwiLFxcbiAgICBzZWNvbmQ6IFxcXCIyLWRpZ2l0XFxcIixcXG4gICAgaG91cjEyOiB0cnVlLFxcbiAgfSk7XFxuXFxuICBjb25zb2xlLmxvZyhgJHtmb3JtYXR0ZWRUaW1lfSBbJHtzb3VyY2V9XSAke21lc3NhZ2V9YCk7XFxufVxcblxcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXR1cFZpdGUoYXBwOiBFeHByZXNzLCBzZXJ2ZXI6IFNlcnZlcikge1xcbiAgY29uc3Qgc2VydmVyT3B0aW9ucyA9IHtcXG4gICAgbWlkZGxld2FyZU1vZGU6IHRydWUsXFxuICAgIGhtcjogeyBzZXJ2ZXIgfSxcXG4gICAgYWxsb3dlZEhvc3RzOiB0cnVlIGFzIGNvbnN0LFxcbiAgfTtcXG5cXG4gIGNvbnN0IHZpdGUgPSBhd2FpdCBjcmVhdGVWaXRlU2VydmVyKHtcXG4gICAgLi4udml0ZUNvbmZpZyxcXG4gICAgY29uZmlnRmlsZTogZmFsc2UsXFxuICAgIGN1c3RvbUxvZ2dlcjoge1xcbiAgICAgIC4uLnZpdGVMb2dnZXIsXFxuICAgICAgZXJyb3I6IChtc2csIG9wdGlvbnMpID0+IHtcXG4gICAgICAgIHZpdGVMb2dnZXIuZXJyb3IobXNnLCBvcHRpb25zKTtcXG4gICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcXG4gICAgICB9LFxcbiAgICB9LFxcbiAgICBzZXJ2ZXI6IHNlcnZlck9wdGlvbnMsXFxuICAgIGFwcFR5cGU6IFxcXCJjdXN0b21cXFwiLFxcbiAgfSk7XFxuXFxuICBhcHAudXNlKHZpdGUubWlkZGxld2FyZXMpO1xcbiAgYXBwLnVzZShcXFwiKlxcXCIsIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xcbiAgICBjb25zdCB1cmwgPSByZXEub3JpZ2luYWxVcmw7XFxuXFxuICAgIHRyeSB7XFxuICAgICAgY29uc3QgY2xpZW50VGVtcGxhdGUgPSBwYXRoLnJlc29sdmUoXFxuICAgICAgICBpbXBvcnQubWV0YS5kaXJuYW1lLFxcbiAgICAgICAgXFxcIi4uXFxcIixcXG4gICAgICAgIFxcXCJjbGllbnRcXFwiLFxcbiAgICAgICAgXFxcImluZGV4Lmh0bWxcXFwiLFxcbiAgICAgICk7XFxuXFxuICAgICAgLy8gYWx3YXlzIHJlbG9hZCB0aGUgaW5kZXguaHRtbCBmaWxlIGZyb20gZGlzayBpbmNhc2UgaXQgY2hhbmdlc1xcbiAgICAgIGxldCB0ZW1wbGF0ZSA9IGF3YWl0IGZzLnByb21pc2VzLnJlYWRGaWxlKGNsaWVudFRlbXBsYXRlLCBcXFwidXRmLThcXFwiKTtcXG4gICAgICB0ZW1wbGF0ZSA9IHRlbXBsYXRlLnJlcGxhY2UoXFxuICAgICAgICBgc3JjPVxcXCIvc3JjL21haW4udHN4XFxcImAsXFxuICAgICAgICBgc3JjPVxcXCIvc3JjL21haW4udHN4P3Y9JHtuYW5vaWQoKX1cXFwiYCxcXG4gICAgICApO1xcbiAgICAgIGNvbnN0IHBhZ2UgPSBhd2FpdCB2aXRlLnRyYW5zZm9ybUluZGV4SHRtbCh1cmwsIHRlbXBsYXRlKTtcXG4gICAgICByZXMuc3RhdHVzKDIwMCkuc2V0KHsgXFxcIkNvbnRlbnQtVHlwZVxcXCI6IFxcXCJ0ZXh0L2h0bWxcXFwiIH0pLmVuZChwYWdlKTtcXG4gICAgfSBjYXRjaCAoZSkge1xcbiAgICAgIHZpdGUuc3NyRml4U3RhY2t0cmFjZShlIGFzIEVycm9yKTtcXG4gICAgICBuZXh0KGUpO1xcbiAgICB9XFxuICB9KTtcXG59XFxuXFxuZXhwb3J0IGZ1bmN0aW9uIHNlcnZlU3RhdGljKGFwcDogRXhwcmVzcykge1xcbiAgLy8gRklYRUQ6IFBvaW50IHRvIGNsaWVudC9kaXN0IHdoZXJlIHRoZSBSZWFjdCBhcHAgYWN0dWFsbHkgYnVpbGRzIHRvXFxuICBjb25zdCBkaXN0UGF0aCA9IHBhdGgucmVzb2x2ZShpbXBvcnQubWV0YS5kaXJuYW1lLCBcXFwiLi5cXFwiLCBcXFwiY2xpZW50XFxcIiwgXFxcImRpc3RcXFwiKTtcXG5cXG4gIGlmICghZnMuZXhpc3RzU3luYyhkaXN0UGF0aCkpIHtcXG4gICAgdGhyb3cgbmV3IEVycm9yKFxcbiAgICAgIGBDb3VsZCBub3QgZmluZCB0aGUgYnVpbGQgZGlyZWN0b3J5OiAke2Rpc3RQYXRofSwgbWFrZSBzdXJlIHRvIGJ1aWxkIHRoZSBjbGllbnQgZmlyc3RgLFxcbiAgICApO1xcbiAgfVxcblxcbiAgYXBwLnVzZShleHByZXNzLnN0YXRpYyhkaXN0UGF0aCkpO1xcblxcbiAgLy8gZmFsbCB0aHJvdWdoIHRvIGluZGV4Lmh0bWwgaWYgdGhlIGZpbGUgZG9lc24ndCBleGlzdCAoU1BBIGZhbGxiYWNrKVxcbiAgYXBwLnVzZShcXFwiKlxcXCIsIChfcmVxLCByZXMpID0+IHtcXG4gICAgcmVzLnNlbmRGaWxlKHBhdGgucmVzb2x2ZShkaXN0UGF0aCwgXFxcImluZGV4Lmh0bWxcXFwiKSk7XFxuICB9KTtcXG59XFxuXCIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsZUFBZSwyOEVBQTA4RSJ9